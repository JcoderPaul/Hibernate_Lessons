****** Режимы блокировки на уровне строк ******

Из документации PostgreSQL: https://www.postgresql.org/docs/current/explicit-locking.html

*** FOR UPDATE (ДЛЯ ОБНОВЛЕНИЯ) ***

FOR UPDATE блокирует строки, извлеченные оператором SELECT, как будто для обновления. Это
предотвращает их блокировку, изменение или удаление другими транзакциями до тех пор, пока
текущая транзакция не завершится. То есть другие транзакции, которые пытаются UPDATE, DELETE,
SELECT FOR UPDATE, SELECT FOR NO KEY UPDATE, SELECT FOR SHARE или SELECT FOR KEY SHARE этих
строк, будут заблокированы до завершения текущей транзакции; и наоборот, SELECT FOR UPDATE
будет ожидать параллельной транзакции, которая выполнила любую из этих команд в той же строке,
а затем заблокирует и вернет обновленную строку (или не вернет строку, если строка была удалена).
Однако в рамках транзакции REPEATABLE READ или SERIALIZABLE будет выдана ошибка, если блокируемая
строка изменилась с момента запуска транзакции.

Режим блокировки FOR UPDATE также устанавливается с помощью любого DELETE в строке, а также с
помощью UPDATE, которое изменяет значения определенных столбцов. В настоящее время для случая
UPDATE рассматривается набор столбцов, имеющих уникальный индекс, который можно использовать во
внешнем ключе (поэтому частичные индексы и экспрессивные индексы не учитываются), но это может
измениться в будущем.

*** FOR NO KEY UPDATE (БЕЗ ОБНОВЛЕНИЯ КЛЮЧА) ***

Действует аналогично FOR UPDATE, за исключением того, что полученная блокировка слабее: эта
блокировка не будет блокировать команды SELECT FOR KEY SHARE, которые пытаются получить блокировку
тех же строк. Этот режим блокировки также приобретается любым UPDATE, который не получает
блокировку FOR UPDATE.

*** FOR SHARE (ПОДЕЛИТЬСЯ) ***

Ведет себя так же, как FOR NO KEY UPDATE, за исключением того, что он получает общую блокировку,
а не эксклюзивную блокировку для каждой извлеченной строки. Общая блокировка блокирует выполнение
другими транзакциями UPDATE, DELETE, SELECT FOR UPDATE или SELECT FOR NO KEY UPDATE для этих строк,
но не мешает им выполнять SELECT FOR SHARE или SELECT FOR KEY SHARE.

*** FOR KEY SHARE (ПО ОТКРЫТОМУ КЛЮЧУ) ***

Ведет себя аналогично FOR SHARE, за исключением того, что блокировка слабее: блокируется
SELECT FOR UPDATE, но не SELECT FOR NO KEY UPDATE. Блокировка с общим ключом блокирует другие
транзакции от выполнения DELETE или любого UPDATE, которое изменяет значения ключа, но не другого
UPDATE, а также не предотвращает SELECT FOR NO KEY UPDATE, SELECT FOR SHARE или SELECT FOR KEY SHARE.

PostgreSQL не запоминает никакой информации об измененных строках в памяти, поэтому нет ограничений
на количество одновременно заблокированных строк. Однако блокировка строки может привести к записи
на диск, например, SELECT FOR UPDATE изменяет выбранные строки, чтобы пометить их как заблокированные,
что приведет к записи на диск.